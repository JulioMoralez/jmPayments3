# JmPayments
Простое приложение на технологии **Cloudflow** которое содержит следующие элементы и функционал:
- Стримлет **payments-reader**, который вычитывает транзакции.
Возможны два варианта источников в зависимости от параметра конфигурации *source-payment*:
   * *http* - с помощью HTTP POST запроса вида *{"text":"file1.txt"}* выбирается файл для чтения,
   который скопируется в папку, указанную в конфигурации *default-payment-file-dir* и автоматически прочитается
   * *file* - из указанного в конфигурации каталога *file-dir* файл по маске имени *file-regex*;
- Стримлет **payment-checker**, который принимает сообщение вида *Message(text: String) *
от актора **payments-reader** по каждой строке платежа, и, в случае не удовлетворения маске платежа *payment-regex*(1), 
откидывает сообщение в стримлет **log-payment**, а в случае успеха производит операции с участниками платежа передачей сообщения вида 
*Payment(key: Int, from: String, to: String, value: Int)*;
- Стримлет **log-payment**, который принимает сообщение с текстом *LogMessage(level: LogLevel, text: String)* и пишет в лог.
Также ведется подсчет сообщений по возможным типам: *INFO, WARNING, ERROR*;
- Стримлет **payment-participant**, принимающий сообщение *Payment*.
Если участник операции встречается первый раз, то задается ему стартовый баланс.
В случае наличия участника в файле конфигурации *users-config-file-path* его стартовый баланс
задается из него, иначе используется значение конфигурации *default-user-balance*.
Производится действие с балансом и значением *value*. 
В случае если происходит вычитание такого значения, и баланса не хватает, происходит 
логирование нехватки баланса, баланс остается прежним.
Результат логируется в стримлете **log-payment**.

(1) Маска платежа должна выглядеть следующим образом: \<NAME1> -> \<NAME2>: \<VALUE>
где NAME1 и NAME2 - любой числобуквенный набор, а VALUE - числовое значение

Файл может содержать 1 и более платежей, каждый платёж на своей строке.